%% -*- erlang -*-
%%! -sname sqlfang
%% @doc SQLFang - SQLæ³¨å…¥æ£€æµ‹å·¥å…·
%% ä½œè€…ï¼šé’Ÿæ™ºå¼º @ctkqiang
%% ç”µé‚®ï¼šjohnmelodymel@qq.com
%% 
%% è¿™æ˜¯ä¸€ä¸ªç”¨ Erlang å®ç°çš„è½»é‡çº§ SQL æ³¨å…¥æ£€æµ‹å·¥å…·
%% ä¸»è¦åŠŸèƒ½ï¼š
%%   - è‡ªåŠ¨æ¢æµ‹ SQL æ³¨å…¥æ¼æ´
%%   - æ”¯æŒå¤šç§æ³¨å…¥æŠ€æœ¯ï¼ˆå¸ƒå°”ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ç­‰ï¼‰
%%   - è‡ªåŠ¨è¯†åˆ«æ•°æ®åº“ç±»å‹
%%   - é«˜å¹¶å‘è¯·æ±‚è®¾è®¡
%%
%% ç”¨æ³•ç¤ºä¾‹ï¼š
%%   ./main.erl https://target.com/page.php id
%%
%% å‚æ•°è¯´æ˜ï¼š
%%   - ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡URLï¼ˆéœ€è¦å¸¦åè®®å¤´ï¼‰
%%   - ç¬¬äºŒä¸ªå‚æ•°ï¼šè¦æµ‹è¯•çš„å‚æ•°å
%%
%% æ³¨æ„äº‹é¡¹ï¼š
%%   - ä½¿ç”¨å‰è¯·ç¡®ä¿å·²ç¼–è¯‘æ‰€æœ‰ä¾èµ–æ¨¡å—
%%   - å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ï¼Œå‹¿ç”¨äºæœªæˆæƒç›®æ ‡
%%   - éµå®ˆã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹

%% ============================================================================
%% == é‡è¦å£°æ˜ ==
%% ============================================================================
%% æœ¬ç¨‹åºä»…ä¾›å­¦ä¹ å’ŒæŠ€æœ¯ç ”ç©¶ä½¿ç”¨ï¼Œç¦æ­¢å°†å…¶ç”¨äºä»»ä½•æœªè·æˆæƒçš„ä¾µå…¥ã€
%% æ”»å‡»ã€ç›‘å¬ã€å¹²æ‰°æˆ–å…¶ä»–è¿åç½‘ç»œå®‰å…¨å’Œéšç§ä¿æŠ¤çš„è¡Œä¸ºã€‚
%%
%% ä½¿ç”¨è€…å¿…é¡»åœ¨**å®Œå…¨ç†è§£å¹¶åŒæ„ä¸Šè¿°æ¡æ¬¾**çš„å‰æä¸‹ä½¿ç”¨æœ¬ç¨‹åºã€‚
%% ä»»ä½•å°†æœ¬ç¨‹åºç”¨äº**éæ³•ç›®çš„**çš„è¡Œä¸ºï¼Œå…¶**æ‰€æœ‰åæœ**ï¼ˆåŒ…æ‹¬ä½†ä¸é™äº
%% è¡Œæ”¿å¤„ç½šã€æ°‘äº‹èµ”å¿ã€åˆ‘äº‹è´£ä»»ï¼‰**å‡ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…**ã€‚
%%
%% è¯·åŠ¡å¿…éµå®ˆæ‚¨æ‰€åœ¨å›½å®¶å’Œåœ°åŒºçš„ç›¸å…³æ³•å¾‹æ³•è§„ï¼Œç‰¹åˆ«æ˜¯ä»¥ä¸‹ä¸­å›½æ³•å¾‹æ¡æ¬¾ï¼š
%%
%% - ã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ ç¬¬åäºŒæ¡ï¼šä»»ä½•ä¸ªäººå’Œç»„ç»‡ä¸å¾—åˆ©ç”¨ç½‘ç»œ
%%   ä»äº‹å±å®³å›½å®¶å®‰å…¨ã€è£èª‰å’Œåˆ©ç›Šï¼Œç…½åŠ¨é¢ è¦†å›½å®¶æ”¿æƒç­‰è¿æ³•çŠ¯ç½ªæ´»åŠ¨ã€‚
%% - ã€Šä¸­åäººæ°‘å…±å’Œå›½åˆ‘æ³•ã€‹ ç¬¬äºŒç™¾å…«åäº”æ¡è‡³ç¬¬äºŒç™¾å…«åä¸ƒæ¡ï¼š
%%   éæ³•ä¾µå…¥è®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿã€ç ´åç³»ç»ŸåŠŸèƒ½æˆ–æ•°æ®çš„è¡Œä¸ºå°†è¢«è¿½ç©¶åˆ‘äº‹è´£ä»»ã€‚
%% - ã€Šä¸­åäººæ°‘å…±å’Œå›½æ•°æ®å®‰å…¨æ³•ã€‹ ç¬¬ä¸‰æ¡ã€ç¬¬åä¸ƒæ¡ï¼š
%%   ä»äº‹æ•°æ®å¤„ç†æ´»åŠ¨åº”å½“ä¾æ³•ä¿éšœæ•°æ®å®‰å…¨ï¼Œç¦æ­¢éæ³•è·å–ã€æ³„éœ²æ•°æ®ã€‚
%%
%% ğŸ’¡ç‰¹åˆ«æé†’ï¼šæœ¬ç¨‹åºè®¾è®¡ä¸­å¯èƒ½æ¶‰åŠç½‘ç»œé€šä¿¡ã€æ•°æ®æ”¶é›†ã€è¿œç¨‹æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œ
%% å‡åº”åœ¨**æˆæƒèŒƒå›´å†…**ä½¿ç”¨ï¼Œä»»ä½•å¯¹è®¾å¤‡ã€ç³»ç»Ÿã€æ•°æ®çš„æœªç»æˆæƒçš„è®¿é—®æˆ–æ§åˆ¶
%% éƒ½å±äºè¿æ³•è¡Œä¸ºã€‚
%%
%% ğŸ“› è¿åä»¥ä¸Šæ¡æ¬¾é€ æˆçš„ä¸€åˆ‡æ³•å¾‹åæœä¸è´£ä»»ï¼Œä¸ä½œè€…æ— å…³ã€‚
%%
%% ============================================================================

-module(main).
-export([main/1]).

-mode(compile).

%% main/1 - ä¸»å…¥å£å‡½æ•°
%% å‚æ•°ï¼š
%%   - [Url, Param]ï¼šåŒ…å«ç›®æ ‡URLå’Œæ³¨å…¥å‚æ•°çš„åˆ—è¡¨
%%   - ç¤ºä¾‹ï¼š["https://target.com/page.php", "id"]
main([Url, Param]) ->
    io:format("~nğŸš€ SQLFang å¯åŠ¨ä¸­...~n"),
    io:format("ğŸ¯ ç›®æ ‡åœ°å€: ~s~n", [Url]),
    io:format("ğŸ”‘ æ³¨å…¥å‚æ•°: ~s~n", [Param]),

    % å¯åŠ¨ http å’Œ ssl æ”¯æŒï¼Œç¡®ä¿èƒ½å‘é€ HTTPS è¯·æ±‚
    application:start(inets),
    application:start(ssl),

    % è½½å…¥æ¨¡å—è·¯å¾„ï¼ˆéœ€è¦æå‰ç¼–è¯‘å¥½ .beam æ–‡ä»¶ï¼‰
    code:add_path("ebin"),

    % æ‰§è¡Œæ‰«ææµç¨‹ï¼šå…ˆåˆå§‹åŒ–æ‰«æå™¨ï¼Œç„¶åå¼€å§‹æ‰«æ
    case scanner:start() of
        ok ->
            case scanner:scan(Url, Param) of
                {error, Reason} ->
                    io:format("âŒ æ‰«æå¤±è´¥: ~p~n", [Reason]);
                _ ->
                    ok
            end;
        error ->
            io:format("âŒ æ‰«æå™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·ç¡®ä¿ä¾èµ–æ¨¡å—ç¼–è¯‘å®Œæˆå¹¶å¯è®¿é—®~n")
    end;

%% å‚æ•°é”™è¯¯æ—¶çš„å¤„ç†åˆ†æ”¯
%% æ¸©é¦¨æç¤ºç”¨æˆ·æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼
main(_) ->
    io:format("âŒ å‚æ•°ä¸è¶³ï¼Œè¯·æä¾›ç›®æ ‡ URL å’Œå‚æ•°åï¼Œä¾‹å¦‚ï¼š ./main.erl https://site.com/page.php id~n").
